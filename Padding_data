import os
import cv2
import albumentations as A
from tqdm import tqdm  # để hiển thị thanh tiến trình
import matplotlib.pyplot as plt  # nếu muốn hiển thị (không bắt buộc)

# --- Cấu hình đường dẫn ---
input_folder = 'C:\\Users\\FPT\\PyCharmMiscProject\\bien_bao_cam'  # Thư mục chứa ảnh gốc
output_folder = 'C:\\Users\\FPT\\PyCharmMiscProject\\data'  # Thư mục lưu ảnh đã augmentation

os.makedirs(output_folder, exist_ok=True)  # tạo thư mục nếu chưa có

# --- Định nghĩa pipeline augmentation ---
transform = A.Compose([
    A.LongestMaxSize(max_size=256),
    A.PadIfNeeded(min_height=256, min_width=256, border_mode=0, value=(114, 114, 114)),
])

# --- Xử lý từng ảnh trong folder ---
for filename in tqdm(os.listdir(input_folder)):
    if filename.lower().endswith(('.png', '.jpg', '.jpeg', '.bmp', '.tiff')):
        input_path = os.path.join(input_folder, filename)
        output_path = os.path.join(output_folder, filename)

        # Đọc ảnh, chuyển BGR -> RGB
        image = cv2.imread(input_path)
        if image is None:
            print(f"Không đọc được ảnh {filename}, bỏ qua.")
            continue
        image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)

        print(f"Ảnh gốc {filename} shape:", image.shape)

        # Augmentation
        augmented = transform(image=image)
        augmented_image = augmented['image']

        print(f"Ảnh sau augmentation {filename} shape:", augmented_image.shape)

        # Chuyển RGB -> BGR để lưu bằng OpenCV
        augmented_image = cv2.cvtColor(augmented_image, cv2.COLOR_RGB2BGR)

        # Lưu ảnh đã augmentation
        cv2.imwrite(output_path, augmented_image)

print("Xử lý ảnh hoàn tất!")
